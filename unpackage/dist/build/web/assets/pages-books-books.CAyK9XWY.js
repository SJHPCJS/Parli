import{$ as s,a as o,s as t,j as e,k as a,c as l,w as i,i as r,o as c,d as n,e as d,t as u,l as k,r as f,F as g,m as _,f as h,g as b,p}from"./index-B7OQiFPg.js";import{c as B,g as C,s as P,d as m,e as w,f as y}from"./bookData.ioIksG53.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const W=x({data:()=>({bookList:B,currentBook:{},bookProgresses:{},bookWrongCounts:{}}),async onLoad(){this.currentBook=await C(),this.loadBookStatistics()},async onShow(){this.currentBook=await C(),this.loadBookStatistics()},onLoad(){s("learningComplete",(()=>{this.loadBookStatistics()}))},onUnload(){o("learningComplete")},methods:{selectBook(s){this.currentBook.id!==s.id&&(P(s.id),this.currentBook=s,t({title:`已切换到《${s.title}》`,icon:"success"}),setTimeout((()=>{e({url:"/pages/index/index"})}),1e3))},getBookProgressPercent(s){const o=this.bookProgresses[s];return o&&o.percentage||0},getBookWrongCount(s){return this.bookWrongCounts[s]||0},async loadBookStatistics(){try{for(const s of this.bookList){const o=await m(s.id);if(1===s.id){const o=await w();this.$set(this.bookWrongCounts,s.id,o.length)}else this.$set(this.bookWrongCounts,s.id,0);this.$set(this.bookProgresses,s.id,o)}}catch(s){console.error("加载书籍统计失败:",s)}},getBookWordsCount(s){const o=B.find((o=>o.id===s));return o?o.wordCount:0},showAllProgress(){let s="📚 总体学习进度：\n\n";B.forEach((o=>{const t=this.getBookProgressPercent(o.id),e=this.getBookWrongCount(o.id);s+=`${o.title}\n进度：${t}% | 错题：${e}个\n\n`})),a({title:"学习统计",content:s,showCancel:!1})},resetAllProgress(){a({title:"重置所有数据",content:"确定要重置所有书籍的学习进度吗？此操作不可恢复。",success:s=>{s.confirm&&(B.forEach((s=>{y(s.id,{learnedWords:[],wrongWords:[],reviewWords:[]})})),t({title:"重置成功",icon:"success"}))}})},exportProgress(){let s={exportTime:(new Date).toLocaleString(),books:{}};B.forEach((o=>{const t=m(o.id);s.books[o.id]={title:o.title,progress:t,progressPercent:this.getBookProgressPercent(o.id)}}));const o=JSON.stringify(s,null,2);a({title:"导出数据",content:"学习数据已生成，请复制保存。",showCancel:!1,success:()=>{console.log("Export data:",o)}})}}},[["render",function(s,o,t,e,a,B){const C=r,P=p;return c(),l(C,{class:"container"},{default:i((()=>[n(C,{class:"header"},{default:i((()=>[n(C,{class:"title"},{default:i((()=>[d("选择学习书籍")])),_:1}),n(C,{class:"subtitle"},{default:i((()=>[d(u(a.bookList?a.bookList.length:0)+"本书籍可供选择",1)])),_:1})])),_:1}),n(C,{class:"books-list"},{default:i((()=>[(c(!0),k(g,null,f(a.bookList,(s=>(c(),l(C,{key:s.id,class:_(["book-card",{active:a.currentBook.id===s.id}]),style:h({background:`linear-gradient(135deg, ${s.color}99, ${s.color}dd)`}),onClick:o=>B.selectBook(s)},{default:i((()=>[n(C,{class:"book-cover"},{default:i((()=>[d(u(s.cover),1)])),_:2},1024),n(C,{class:"book-info"},{default:i((()=>[n(C,{class:"book-title"},{default:i((()=>[d(u(s.title),1)])),_:2},1024),n(C,{class:"book-subtitle"},{default:i((()=>[d(u(s.subtitle),1)])),_:2},1024),n(C,{class:"book-desc"},{default:i((()=>[d(u(s.description),1)])),_:2},1024),n(C,{class:"book-meta"},{default:i((()=>[n(C,{class:"difficulty"},{default:i((()=>[d(u(s.difficulty),1)])),_:2},1024),n(C,{class:"word-count"},{default:i((()=>[d(u(s.wordCount)+"词",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(C,{class:"book-progress"},{default:i((()=>[n(C,{class:"progress-info"},{default:i((()=>[n(P,null,{default:i((()=>[d("学习进度："+u(B.getBookProgressPercent(s.id))+"%",1)])),_:2},1024),n(P,null,{default:i((()=>[d("错题："+u(B.getBookWrongCount(s.id)),1)])),_:2},1024)])),_:2},1024),n(C,{class:"progress-bar"},{default:i((()=>[n(C,{class:"progress-fill",style:h({width:B.getBookProgressPercent(s.id)+"%"})},null,8,["style"])])),_:2},1024)])),_:2},1024),a.currentBook.id===s.id?(c(),l(C,{key:0,class:"selected-mark"},{default:i((()=>[n(P,null,{default:i((()=>[d("✓")])),_:1})])),_:1})):b("",!0)])),_:2},1032,["class","style","onClick"])))),128))])),_:1}),n(C,{class:"quick-actions"},{default:i((()=>[n(C,{class:"section-title"},{default:i((()=>[d("快速操作")])),_:1}),n(C,{class:"actions-grid"},{default:i((()=>[n(C,{class:"action-item",onClick:B.showAllProgress},{default:i((()=>[n(C,{class:"action-icon"},{default:i((()=>[d("📊")])),_:1}),n(C,{class:"action-text"},{default:i((()=>[d("总体进度")])),_:1})])),_:1},8,["onClick"]),n(C,{class:"action-item",onClick:B.resetAllProgress},{default:i((()=>[n(C,{class:"action-icon"},{default:i((()=>[d("🔄")])),_:1}),n(C,{class:"action-text"},{default:i((()=>[d("重置所有")])),_:1})])),_:1},8,["onClick"]),n(C,{class:"action-item",onClick:B.exportProgress},{default:i((()=>[n(C,{class:"action-icon"},{default:i((()=>[d("📤")])),_:1}),n(C,{class:"action-text"},{default:i((()=>[d("导出数据")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-897856ad"]]);export{W as default};
