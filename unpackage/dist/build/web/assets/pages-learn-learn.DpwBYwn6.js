import{s as t,b as s,h as e,k as l,j as i,A as a,B as n,c as r,w as o,i as u,o as c,d,e as h,t as p,f,l as g,r as _,F as m,m as w,g as k,p as R,z as W,I as C}from"./index-B7OQiFPg.js";import{p as x,g as y,h as D,i as I,j as b,r as S,k as L,l as Q}from"./bookData.ioIksG53.js";import{_ as v}from"./_plugin-vue_export-helper.BCo6x5W8.js";const q=v({data:()=>({step:1,current:{},options:[],selectedOption:-1,showResult:!1,step1Result:!1,userInput:"",showSpellingResult:!1,spellingResult:!1,showWordDetail:!1,currentIndex:0,totalQuestions:10,correctAnswers:0,wrongAnswers:0,isCompleted:!1,questionWords:[],posMap:x||{},currentBook:{},dataLoaded:!1,totalWords:0,currentWordDetail:null}),computed:{progressWidth(){return this.currentIndex/this.totalQuestions*100}},onLoad(){try{this.currentBook=y(),this.initLearning()}catch(s){console.error("页面加载失败:",s),this.dataLoaded=!0,t({title:"页面加载失败",icon:"error"})}},methods:{async initLearning(){try{s({title:"加载词典数据..."}),this.questionWords=[],this.currentIndex=0,this.correctAnswers=0,this.wrongAnswers=0,this.isCompleted=!1,this.current={},this.options=[],this.currentWordDetail=null;const a=await D(),n=(await I()).map((t=>t.id)),r=a.filter((t=>!n.includes(t.id)));if(e(),!r||0===r.length)return this.dataLoaded=!0,void l({title:"🎉 恭喜完成学习！",content:"您已经学完了当前书籍的所有单词！可以继续复习错题或开始新的学习挑战。",confirmText:"复习错题",cancelText:"回到首页",success:t=>{t.confirm?i({url:"/pages/review/review"}):i({url:"/pages/index/index"})}});const o=Math.min(this.totalQuestions,r.length),u=[...r].filter((t=>t&&t.id&&t.word));if(0===u.length)return this.dataLoaded=!0,void t({title:"词汇数据异常",icon:"error"});for(let t=0;t<o&&u.length>0;t++){const t=Math.floor(Math.random()*u.length);this.questionWords.push(u[t]),u.splice(t,1)}this.totalQuestions=this.questionWords.length,this.totalWords=r.length,this.dataLoaded=!0,this.questionWords.length>0?this.loadQuestion():this.isCompleted=!0}catch(n){e(),this.dataLoaded=!0,console.error("初始化学习数据失败:",n),l({title:"错误",content:"加载词典数据失败，请重试",success:()=>{a()}})}},async loadQuestion(){if(this.currentIndex>=this.totalQuestions)this.isCompleted=!0;else{if(!this.questionWords||0===this.questionWords.length||!this.questionWords[this.currentIndex])return console.error("questionWords数据异常:",this.questionWords),void(this.isCompleted=!0);this.current=this.questionWords[this.currentIndex]||{},await this.generateOptions(),this.resetState()}},async generateOptions(){try{if(!this.current||!this.current.id)return console.error("current对象无效:",this.current),void(this.options=[]);const t=await D();if(!t||0===t.length)return console.error("无法获取词汇数据"),void(this.options=[this.current]);const s=t.filter((t=>t&&t.id&&t.id!==this.current.id)).sort((()=>.5-Math.random())).slice(0,2);this.options=[this.current,...s].filter((t=>t&&t.id)).sort((()=>.5-Math.random())),0===this.options.length&&(this.options=[this.current])}catch(t){console.error("生成选项失败:",t),this.options=this.current?[this.current]:[]}},resetState(){this.step=1,this.selectedOption=-1,this.showResult=!1,this.step1Result=!1,this.userInput="",this.showSpellingResult=!1,this.spellingResult=!1,this.showWordDetail=!1},selectOption(t,s){!this.showResult&&s&&(this.selectedOption=t,this.step1Result=s&&s.id===this.current.id,this.showResult=!0,this.step1Result||(this.current&&this.current.id&&b(this.current.id),setTimeout((()=>{this.showResult=!1,this.selectedOption=-1}),2e3)))},goToStep2(){this.step=2,this.showResult=!1},checkSpelling(){if(!this.userInput.trim()||!this.current||!this.current.word)return;const t=this.userInput.trim().toLowerCase(),s=this.current.word.toLowerCase();if(this.spellingResult=t===s,this.showSpellingResult=!0,this.step1Result&&this.current&&this.current.id){S(this.current.id),L(this.current.id),this.correctAnswers++;const t=Q(this.current.id);this.currentWordDetail=t||{...this.current,meanings:this.current.meanings||[this.current.meaning],examples:this.current.examples||[],fullContent:this.current.fullContent||""},setTimeout((()=>{this.showWordDetail=!0}),1500)}this.spellingResult||console.log("拼写错误，但不计入错题")},clearSpellingResult(){this.showSpellingResult=!1},async nextQuestion(){this.showWordDetail=!1,this.currentWordDetail=null,this.showSpellingResult=!1,this.userInput="",this.currentIndex++,await this.loadQuestion(),this.isCompleted&&n("learningComplete")},restartLearning(){this.dataLoaded=!1,this.initLearning()},goHome(){n("learningComplete"),a()},skipCurrentWord(){l({title:"跳过单词",content:"确定要跳过这个单词吗？跳过的单词不会被标记为已学会。",success:t=>{t.confirm&&this.nextQuestion()}})}}},[["render",function(t,s,e,l,i,a){const n=u,x=R,y=W,D=C;return c(),r(n,{class:"container"},{default:o((()=>[i.dataLoaded?(c(),r(n,{key:1},{default:o((()=>[d(n,{class:"progress-bar"},{default:o((()=>[d(n,{class:"progress-fill",style:f({width:a.progressWidth+"%"})},null,8,["style"])])),_:1}),d(n,{class:"progress-text"},{default:o((()=>[h("第"+p(i.currentIndex+1)+"题 / 共"+p(i.totalQuestions)+"题",1)])),_:1}),1===i.step&&i.current&&i.current.word?(c(),r(n,{key:0,class:"step-container"},{default:o((()=>[d(n,{class:"title"},{default:o((()=>[h("请选择该单词的词性和意思")])),_:1}),d(n,{class:"word-display"},{default:o((()=>[h(p(i.current.word),1)])),_:1}),d(n,{class:"options-container"},{default:o((()=>[(c(!0),g(m,null,_(i.options,((t,s)=>(c(),r(n,{key:s,class:w(["option",{selected:i.selectedOption===s,correct:i.showResult&&t&&t.id===i.current.id,wrong:i.showResult&&i.selectedOption===s&&t&&t.id!==i.current.id}]),onClick:e=>a.selectOption(s,t)},{default:o((()=>[t&&t.pos&&t.meaning?(c(),r(n,{key:0,class:"option-text"},{default:o((()=>[d(x,{class:"pos-tag"},{default:o((()=>[h(p(i.posMap[t.pos]||t.pos),1)])),_:2},1024),d(x,{class:"meaning"},{default:o((()=>[h(p(t.meaning),1)])),_:2},1024)])),_:2},1024)):k("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),i.showResult?(c(),r(n,{key:0,class:"result-container"},{default:o((()=>[d(n,{class:w(["result-text",{correct:i.step1Result,wrong:!i.step1Result}])},{default:o((()=>[h(p(i.step1Result?"正确！继续下一步":"错误！请重新选择"),1)])),_:1},8,["class"]),i.step1Result?(c(),r(y,{key:0,class:"next-btn",onClick:a.goToStep2},{default:o((()=>[h("下一步：拼写练习")])),_:1},8,["onClick"])):k("",!0)])),_:1})):k("",!0),i.showResult?k("",!0):(c(),r(n,{key:1,class:"skip-container"},{default:o((()=>[d(y,{class:"skip-btn",onClick:a.skipCurrentWord},{default:o((()=>[h("跳过此单词")])),_:1},8,["onClick"])])),_:1}))])),_:1})):k("",!0),2===i.step&&i.current&&i.current.word?(c(),r(n,{key:1,class:"step-container"},{default:o((()=>[d(n,{class:"spelling-header"},{default:o((()=>[d(n,{class:"step-title"},{default:o((()=>[h("✍️ 拼写练习")])),_:1}),d(n,{class:"hint-card"},{default:o((()=>[d(n,{class:"word-clue"},{default:o((()=>[d(n,{class:"pos-badge"},{default:o((()=>[h(p(i.posMap[i.current.pos]||i.current.pos),1)])),_:1}),d(n,{class:"meaning-hint"},{default:o((()=>[h(p(i.current.meaning),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(n,{class:"spelling-input-section"},{default:o((()=>[d(n,{class:"input-label"},{default:o((()=>[h("请输入意大利语单词：")])),_:1}),d(n,{class:"input-wrapper"},{default:o((()=>[d(D,{modelValue:i.userInput,"onUpdate:modelValue":s[0]||(s[0]=t=>i.userInput=t),placeholder:"输入单词...",class:w(["spelling-input",{"input-correct":i.showSpellingResult&&i.spellingResult,"input-wrong":i.showSpellingResult&&!i.spellingResult}]),onInput:a.clearSpellingResult,onConfirm:a.checkSpelling,"confirm-type":"done",focus:""},null,8,["modelValue","class","onInput","onConfirm"]),d(y,{class:"check-button",onClick:a.checkSpelling,disabled:!i.userInput.trim()},{default:o((()=>[d(x,{class:"check-icon"},{default:o((()=>[h("✓")])),_:1}),d(x,null,{default:o((()=>[h("检查")])),_:1})])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),i.showSpellingResult?(c(),r(n,{key:0,class:"spelling-result"},{default:o((()=>[d(n,{class:w(["result-card",{success:i.spellingResult,error:!i.spellingResult}])},{default:o((()=>[d(n,{class:"result-icon"},{default:o((()=>[h(p(i.spellingResult?"🎉":"❌"),1)])),_:1}),d(n,{class:"result-text"},{default:o((()=>[d(n,{class:"result-title"},{default:o((()=>[h(p(i.spellingResult?"拼写正确！":"拼写错误"),1)])),_:1}),i.spellingResult?k("",!0):(c(),r(n,{key:0,class:"correct-answer"},{default:o((()=>[h(" 正确答案："),d(x,{class:"answer-word"},{default:o((()=>[h(p(i.current.word),1)])),_:1})])),_:1}))])),_:1})])),_:1},8,["class"])])),_:1})):k("",!0),d(n,{class:"skip-container"},{default:o((()=>[d(y,{class:"skip-btn",onClick:a.skipCurrentWord},{default:o((()=>[h("跳过此单词")])),_:1},8,["onClick"])])),_:1})])),_:1})):k("",!0),i.showWordDetail&&i.currentWordDetail?(c(),r(n,{key:2,class:"word-detail-section"},{default:o((()=>[d(n,{class:"detail-header"},{default:o((()=>[d(n,{class:"detail-title"},{default:o((()=>[h("📖 词汇详解")])),_:1}),d(n,{class:"congratulations"},{default:o((()=>[h("恭喜！已掌握这个单词")])),_:1})])),_:1}),d(n,{class:"detail-card"},{default:o((()=>[d(n,{class:"word-main-info"},{default:o((()=>[d(n,{class:"word-display"},{default:o((()=>[h(p(i.currentWordDetail.word),1)])),_:1}),d(n,{class:"word-meta"},{default:o((()=>[d(n,{class:"pos-tag"},{default:o((()=>[h(p(i.posMap[i.currentWordDetail.pos]||i.currentWordDetail.pos),1)])),_:1}),d(n,{class:"word-id"},{default:o((()=>[h("ID: "+p(i.currentWordDetail.id),1)])),_:1})])),_:1})])),_:1}),d(n,{class:"meanings-section"},{default:o((()=>[d(n,{class:"section-title"},{default:o((()=>[h("📝 释义")])),_:1}),d(n,{class:"meanings-list"},{default:o((()=>[(c(!0),g(m,null,_(i.currentWordDetail.meanings,((t,s)=>(c(),r(n,{key:s,class:"meaning-item"},{default:o((()=>[d(n,{class:"meaning-number"},{default:o((()=>[h(p(s+1),1)])),_:2},1024),d(n,{class:"meaning-text"},{default:o((()=>[h(p(t),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),i.currentWordDetail.examples&&i.currentWordDetail.examples.length>0?(c(),r(n,{key:0,class:"examples-section"},{default:o((()=>[d(n,{class:"section-title"},{default:o((()=>[h("💡 例句")])),_:1}),d(n,{class:"examples-list"},{default:o((()=>[(c(!0),g(m,null,_(i.currentWordDetail.examples,((t,s)=>(c(),r(n,{key:s,class:"example-item"},{default:o((()=>[h(p(t),1)])),_:2},1024)))),128))])),_:1})])),_:1})):k("",!0),i.currentWordDetail.fullContent?(c(),r(n,{key:1,class:"full-content-section"},{default:o((()=>[d(n,{class:"section-title"},{default:o((()=>[h("📚 完整释义")])),_:1}),d(n,{class:"full-content-text"},{default:o((()=>[h(p(i.currentWordDetail.fullContent),1)])),_:1})])),_:1})):k("",!0)])),_:1}),d(n,{class:"detail-actions"},{default:o((()=>[d(y,{class:"next-word-btn",onClick:a.nextQuestion},{default:o((()=>[d(x,{class:"btn-icon"},{default:o((()=>[h("→")])),_:1}),d(x,null,{default:o((()=>[h("下一个单词")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})):k("",!0),i.isCompleted?(c(),r(n,{key:3,class:"completion-container"},{default:o((()=>[d(n,{class:"completion-icon"},{default:o((()=>[h("🎉")])),_:1}),d(n,{class:"completion-title"},{default:o((()=>[h("学习完成！")])),_:1}),d(n,{class:"completion-stats"},{default:o((()=>[d(n,{class:"stat-item"},{default:o((()=>[d(x,{class:"stat-label"},{default:o((()=>[h("总题数：")])),_:1}),d(x,{class:"stat-value"},{default:o((()=>[h(p(i.totalQuestions),1)])),_:1})])),_:1}),d(n,{class:"stat-item"},{default:o((()=>[d(x,{class:"stat-label"},{default:o((()=>[h("正确率：")])),_:1}),d(x,{class:"stat-value"},{default:o((()=>[h(p(i.totalQuestions>0?Math.round(i.correctAnswers/i.totalQuestions*100):0)+"%",1)])),_:1})])),_:1}),d(n,{class:"stat-item"},{default:o((()=>[d(x,{class:"stat-label"},{default:o((()=>[h("错题数：")])),_:1}),d(x,{class:"stat-value"},{default:o((()=>[h(p(i.wrongAnswers),1)])),_:1})])),_:1})])),_:1}),d(y,{class:"restart-btn",onClick:a.restartLearning},{default:o((()=>[h("再来一轮")])),_:1},8,["onClick"]),d(y,{class:"home-btn",onClick:a.goHome},{default:o((()=>[h("回到首页")])),_:1},8,["onClick"])])),_:1})):k("",!0)])),_:1})):(c(),r(n,{key:0,class:"loading-container"},{default:o((()=>[d(n,{class:"loading-icon"},{default:o((()=>[h("📚")])),_:1}),d(n,{class:"loading-text"},{default:o((()=>[h("正在加载词汇数据...")])),_:1}),d(n,{class:"loading-detail"},{default:o((()=>[h("当前词汇数量："+p(i.totalWords),1)])),_:1})])),_:1}))])),_:1})}],["__scopeId","data-v-741af4bd"]]);export{q as default};
