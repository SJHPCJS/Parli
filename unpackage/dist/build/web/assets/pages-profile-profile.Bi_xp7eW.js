import{q as t,$ as e,a as s,u as a,v as l,n as o,k as n,x as i,s as c,y as d,c as r,w as u,i as g,o as f,d as _,e as h,t as m,g as k,l as p,r as L,F as b,p as y,z as W,m as v,f as C}from"./index-B7OQiFPg.js";import{c as w,a as S,b as U,g as D}from"./bookData.ioIksG53.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=B({data:()=>({bookList:w,currentUser:null,userStats:null,totalLearnedWords:0,totalWrongWords:0,completedBooks:0,achievements:[{id:1,title:"初学者",description:"学习第一个单词",icon:"🌱",unlocked:!1,condition:t=>t.totalLearnedWords>=1},{id:2,title:"勤学者",description:"学习50个单词",icon:"📚",unlocked:!1,condition:t=>t.totalLearnedWords>=50},{id:3,title:"进步者",description:"学习100个单词",icon:"🚀",unlocked:!1,condition:t=>t.totalLearnedWords>=100},{id:4,title:"专家级",description:"学习200个单词",icon:"👑",unlocked:!1,condition:t=>t.totalLearnedWords>=200},{id:5,title:"完美主义者",description:"完成一本书的学习",icon:"💯",unlocked:!1,condition:t=>t.completedBooks>=1},{id:6,title:"坚持者",description:"注册7天以上",icon:"🔥",unlocked:!1,condition:t=>t.registeredDays>=7}]}),computed:{isLoggedIn:()=>t()},onLoad(){this.loadUserData()},onShow(){this.loadUserData()},onLoad(){e("learningComplete",(()=>{this.loadUserData()}))},onUnload(){s("learningComplete")},methods:{loadUserData(){this.currentUser=a(),this.userStats=l(),this.isLoggedIn&&(this.calculateTotalStats(),this.updateAchievements())},async calculateTotalStats(){try{let t=0,e=0,s=0;if(w&&w.length>0){const a=await S(),l=await U();t=a.length,e=l.length;const o=await D();o&&a.length>=o.wordCount&&(s=1)}this.totalLearnedWords=t,this.totalWrongWords=e,this.completedBooks=s}catch(t){console.error("计算统计失败:",t),this.totalLearnedWords=0,this.totalWrongWords=0,this.completedBooks=0}},updateAchievements(){const t={totalLearnedWords:this.totalLearnedWords,registeredDays:this.userStats?this.userStats.registeredDays:0,completedBooks:this.completedBooks};this.achievements.forEach((e=>{e.unlocked=e.condition(t)}))},getBookProgressPercent(t){if(!this.isLoggedIn)return 0;try{const e=w.find((e=>e.id===t));if(!e)return 0;const s=getCurrentBookLearnedWords(),a=Math.round(s.length/e.wordCount*100);return Math.min(a,100)}catch(e){return 0}},formatDate(t){if(!t)return"未知";try{return new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(e){return"未知"}},goToLogin(){o({url:"/pages/login/login"})},goToRegister(){o({url:"/pages/register/register"})},confirmLogout(){n({title:"确认退出",content:"退出登录后，您需要重新登录才能查看学习进度。确定要退出吗？",success:t=>{t.confirm&&this.handleLogout()}})},handleLogout(){const t=i();t.success?(c({title:t.message,icon:"success"}),this.currentUser=null,this.userStats=null,this.totalLearnedWords=0,this.totalWrongWords=0,this.completedBooks=0,setTimeout((()=>{d({url:"/pages/login/login"})}),1500)):c({title:t.message,icon:"none"})},showStudyStats(){const t=`学习统计：\n      \n总学习词汇：${this.totalLearnedWords} 个\n总错题数：${this.totalWrongWords} 个\n完成书籍：${this.completedBooks} 本\n注册天数：${this.userStats?this.userStats.registeredDays:0} 天\n\n继续努力学习意大利语！🇮🇹`;n({title:"📊 学习统计",content:t,showCancel:!1})},showAbout(){n({title:"ℹ️ 关于应用",content:"记意 Parli v1.0\n\n一款专为中文用户设计的意大利语学习应用\n\n📖 词典：45893个词条\n🎯 功能：学习、复习、测试\n🌟 特色：多用户、进度保存、成就系统\n\n让意大利语学习变得简单有趣！",showCancel:!1})}}},[["render",function(t,e,s,a,l,o){const n=g,i=y,c=W;return f(),r(n,{class:"container"},{default:u((()=>[_(n,{class:"user-section"},{default:u((()=>[_(n,{class:"avatar-container"},{default:u((()=>[_(n,{class:"avatar"},{default:u((()=>[h("👤")])),_:1}),_(n,{class:"user-info"},{default:u((()=>[_(n,{class:"user-name"},{default:u((()=>[h(m(l.currentUser?l.currentUser.nickname:"未登录"),1)])),_:1}),_(n,{class:"user-subtitle"},{default:u((()=>[l.currentUser?(f(),r(i,{key:0},{default:u((()=>[h("@"+m(l.currentUser.username),1)])),_:1})):(f(),r(i,{key:1},{default:u((()=>[h("点击右上角登录")])),_:1}))])),_:1})])),_:1}),_(n,{class:"login-status"},{default:u((()=>[o.isLoggedIn?(f(),r(c,{key:1,class:"logout-btn",onClick:o.handleLogout},{default:u((()=>[h(" 退出 ")])),_:1},8,["onClick"])):(f(),r(c,{key:0,class:"login-btn",onClick:o.goToLogin},{default:u((()=>[h(" 登录 ")])),_:1},8,["onClick"]))])),_:1})])),_:1}),l.currentUser?(f(),r(n,{key:0,class:"user-stats"},{default:u((()=>[_(n,{class:"stat-item"},{default:u((()=>[_(n,{class:"stat-number"},{default:u((()=>[h(m(l.totalLearnedWords),1)])),_:1}),_(n,{class:"stat-label"},{default:u((()=>[h("总学习词汇")])),_:1})])),_:1}),_(n,{class:"stat-item"},{default:u((()=>[_(n,{class:"stat-number"},{default:u((()=>[h(m(l.userStats?l.userStats.registeredDays:0),1)])),_:1}),_(n,{class:"stat-label"},{default:u((()=>[h("注册天数")])),_:1})])),_:1}),_(n,{class:"stat-item"},{default:u((()=>[_(n,{class:"stat-number"},{default:u((()=>[h(m(l.totalWrongWords),1)])),_:1}),_(n,{class:"stat-label"},{default:u((()=>[h("总错题数")])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1}),o.isLoggedIn?(f(),r(n,{key:0,class:"achievements-section"},{default:u((()=>[_(n,{class:"section-title"},{default:u((()=>[_(i,null,{default:u((()=>[h("🏆 学习成就")])),_:1})])),_:1}),_(n,{class:"achievements-grid"},{default:u((()=>[(f(!0),p(b,null,L(l.achievements,(t=>(f(),r(n,{key:t.id,class:v(["achievement-card",{unlocked:t.unlocked}])},{default:u((()=>[_(n,{class:"achievement-icon"},{default:u((()=>[h(m(t.icon),1)])),_:2},1024),_(n,{class:"achievement-info"},{default:u((()=>[_(n,{class:"achievement-title"},{default:u((()=>[h(m(t.title),1)])),_:2},1024),_(n,{class:"achievement-desc"},{default:u((()=>[h(m(t.description),1)])),_:2},1024)])),_:2},1024),t.unlocked?(f(),r(n,{key:0,class:"achievement-badge"},{default:u((()=>[h("✓")])),_:1})):k("",!0)])),_:2},1032,["class"])))),128))])),_:1})])),_:1})):k("",!0),o.isLoggedIn?(f(),r(n,{key:1,class:"books-progress-section"},{default:u((()=>[_(n,{class:"section-title"},{default:u((()=>[_(i,null,{default:u((()=>[h("📚 书籍进度")])),_:1})])),_:1}),_(n,{class:"books-progress-list"},{default:u((()=>[(f(!0),p(b,null,L(l.bookList,(t=>(f(),r(n,{key:t.id,class:"book-progress-item"},{default:u((()=>[_(n,{class:"book-icon"},{default:u((()=>[h(m(t.cover),1)])),_:2},1024),_(n,{class:"book-info"},{default:u((()=>[_(n,{class:"book-title"},{default:u((()=>[h(m(t.title),1)])),_:2},1024),_(n,{class:"progress-bar"},{default:u((()=>[_(n,{class:"progress-fill",style:C({width:o.getBookProgressPercent(t.id)+"%",backgroundColor:t.color})},null,8,["style"])])),_:2},1024),_(n,{class:"progress-text"},{default:u((()=>[h(m(o.getBookProgressPercent(t.id))+"%",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):k("",!0),o.isLoggedIn?(f(),r(n,{key:2,class:"user-details-section"},{default:u((()=>[_(n,{class:"section-title"},{default:u((()=>[_(i,null,{default:u((()=>[h("👤 账户信息")])),_:1})])),_:1}),_(n,{class:"details-list"},{default:u((()=>[_(n,{class:"detail-item"},{default:u((()=>[_(n,{class:"detail-label"},{default:u((()=>[h("用户名")])),_:1}),_(n,{class:"detail-value"},{default:u((()=>[h(m(l.currentUser.username),1)])),_:1})])),_:1}),_(n,{class:"detail-item"},{default:u((()=>[_(n,{class:"detail-label"},{default:u((()=>[h("昵称")])),_:1}),_(n,{class:"detail-value"},{default:u((()=>[h(m(l.currentUser.nickname),1)])),_:1})])),_:1}),_(n,{class:"detail-item"},{default:u((()=>[_(n,{class:"detail-label"},{default:u((()=>[h("注册时间")])),_:1}),_(n,{class:"detail-value"},{default:u((()=>[h(m(o.formatDate(l.currentUser.createdAt)),1)])),_:1})])),_:1}),_(n,{class:"detail-item"},{default:u((()=>[_(n,{class:"detail-label"},{default:u((()=>[h("最后登录")])),_:1}),_(n,{class:"detail-value"},{default:u((()=>[h(m(o.formatDate(l.currentUser.lastLoginAt)),1)])),_:1})])),_:1})])),_:1})])),_:1})):k("",!0),_(n,{class:"settings-section"},{default:u((()=>[_(n,{class:"section-title"},{default:u((()=>[_(i,null,{default:u((()=>[h("⚙️ 设置")])),_:1})])),_:1}),_(n,{class:"settings-list"},{default:u((()=>[o.isLoggedIn?(f(),r(n,{key:0,class:"setting-item",onClick:o.showStudyStats},{default:u((()=>[_(n,{class:"setting-icon"},{default:u((()=>[h("📊")])),_:1}),_(n,{class:"setting-text"},{default:u((()=>[h("学习统计")])),_:1}),_(n,{class:"setting-arrow"},{default:u((()=>[h(">")])),_:1})])),_:1},8,["onClick"])):k("",!0),_(n,{class:"setting-item",onClick:o.showAbout},{default:u((()=>[_(n,{class:"setting-icon"},{default:u((()=>[h("ℹ️")])),_:1}),_(n,{class:"setting-text"},{default:u((()=>[h("关于应用")])),_:1}),_(n,{class:"setting-arrow"},{default:u((()=>[h(">")])),_:1})])),_:1},8,["onClick"]),o.isLoggedIn?(f(),r(n,{key:1,class:"setting-item danger",onClick:o.confirmLogout},{default:u((()=>[_(n,{class:"setting-icon"},{default:u((()=>[h("🚪")])),_:1}),_(n,{class:"setting-text"},{default:u((()=>[h("退出登录")])),_:1}),_(n,{class:"setting-arrow"},{default:u((()=>[h(">")])),_:1})])),_:1},8,["onClick"])):k("",!0)])),_:1})])),_:1}),o.isLoggedIn?k("",!0):(f(),r(n,{key:3,class:"login-prompt"},{default:u((()=>[_(n,{class:"prompt-icon"},{default:u((()=>[h("🔐")])),_:1}),_(n,{class:"prompt-title"},{default:u((()=>[h("登录以保存学习进度")])),_:1}),_(n,{class:"prompt-desc"},{default:u((()=>[h("登录后您的学习记录将自动云端保存，换设备也不会丢失")])),_:1}),_(c,{class:"prompt-login-btn",onClick:o.goToLogin},{default:u((()=>[h("立即登录")])),_:1},8,["onClick"]),_(c,{class:"prompt-register-btn",onClick:o.goToRegister},{default:u((()=>[h("注册新账号")])),_:1},8,["onClick"])])),_:1}))])),_:1})}],["__scopeId","data-v-4b11bc0c"]]);export{I as default};
